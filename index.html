<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Pro: Stable & Stylish</title>
    <script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #0f172a;
            --panel: #1e293b;
            --primary: #38bdf8;
            --border: 1px solid rgba(255,255,255,0.1);
            --text: #e2e8f0;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Urbanist', sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            height: 100vh;
            display: flex;
            overflow: hidden; /* No Body Scroll */
        }

        /* --- SIDEBAR (Scrollable Settings) --- */
        .sidebar {
            width: 360px;
            background: var(--panel);
            border-right: var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            z-index: 20;
        }

        .header {
            padding: 20px;
            border-bottom: var(--border);
            background: rgba(0,0,0,0.2);
            text-align: center;
        }
        .header h2 { margin: 0; color: var(--primary); letter-spacing: 1px; }

        .scroll-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        /* Custom Scrollbar */
        .scroll-area::-webkit-scrollbar { width: 6px; }
        .scroll-area::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }

        /* Details / Accordion */
        details {
            background: rgba(255,255,255,0.03);
            border: var(--border);
            border-radius: 8px;
            margin-bottom: 12px;
            overflow: hidden;
        }
        summary {
            padding: 12px;
            cursor: pointer;
            font-weight: 600;
            background: rgba(255,255,255,0.05);
            display: flex;
            justify-content: space-between;
        }
        summary:hover { background: rgba(255,255,255,0.08); }
        .inner-content { padding: 15px; }

        /* Inputs */
        label { display: block; font-size: 0.8rem; color: #94a3b8; margin-bottom: 5px; }
        input, select {
            width: 100%; padding: 10px;
            background: #0f172a; border: 1px solid #334155;
            color: white; border-radius: 6px; margin-bottom: 10px;
            font-family: inherit;
        }
        input:focus { border-color: var(--primary); outline: none; }

        .row { display: flex; gap: 10px; }
        .col { flex: 1; }

        /* Color Inputs */
        .color-group { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        input[type="color"] { width: 40px; height: 35px; border: none; padding: 0; cursor: pointer; }

        /* Lock Button */
        .lock-btn {
            background: none; border: 1px solid #475569; color: #94a3b8;
            padding: 8px; border-radius: 6px; cursor: pointer; margin-top: 20px;
        }
        .lock-btn.active { border-color: var(--primary); color: var(--primary); background: rgba(56, 189, 248, 0.1); }


        /* --- PREVIEW AREA (The Fix) --- */
        .main-stage {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-image: radial-gradient(#334155 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* STRICT PREVIEW BOX 
           Yeh box kabhi size change nahi karega.
        */
        #fixed-preview-container {
            width: 380px;  /* FIXED WIDTH */
            height: 380px; /* FIXED HEIGHT */
            
            /* The Glow & Light Border Style */
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 
                0 0 0 4px rgba(255, 255, 255, 0.1), /* Outer Ring */
                0 0 25px rgba(56, 189, 248, 0.4),   /* Blue Glow */
                0 20px 50px rgba(0,0,0,0.5);        /* Shadow */
            border: 2px solid rgba(255,255,255,0.8); /* Light Edge */

            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* Important: Cut overflow */
            padding: 20px; /* Internal Padding */
        }

        /* Force SVG to Fit */
        #fixed-preview-container svg {
            width: 100% !important;
            height: 100% !important;
        }

        /* Buttons */
        .action-bar {
            margin-top: 30px;
            display: flex; gap: 15px;
        }
        button.btn {
            padding: 10px 25px; border: none; border-radius: 50px;
            font-weight: 700; color: white; cursor: pointer;
            transition: 0.2s; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        button.btn:hover { transform: translateY(-2px); }
        .png { background: #10b981; }
        .jpg { background: #f59e0b; }
        .svg { background: #ef4444; }

    </style>
</head>
<body>

    <div class="sidebar">
        <div class="header"><h2>QR MASTER</h2></div>
        
        <div class="scroll-area">
            
            <details open>
                <summary>üìù Content</summary>
                <div class="inner-content">
                    <input type="text" id="data" value="https://github.com" placeholder="Type URL or Text...">
                </div>
            </details>

            <details>
                <summary>üé® Colors</summary>
                <div class="inner-content">
                    <label>Gradient Mode</label>
                    <select id="gradient-type">
                        <option value="solid">Single Color</option>
                        <option value="linear">Linear Gradient</option>
                        <option value="radial">Radial Gradient</option>
                    </select>

                    <div class="color-group">
                        <input type="color" id="col-1" value="#000000">
                        <span style="font-size:0.8rem">Primary Color</span>
                    </div>
                    
                    <div class="color-group" id="col-2-box" style="display:none;">
                        <input type="color" id="col-2" value="#38bdf8">
                        <span style="font-size:0.8rem">Secondary Color</span>
                    </div>

                    <div style="margin-top:10px; padding-top:10px; border-top:1px dashed #333;">
                        <div class="color-group">
                            <input type="color" id="col-bg" value="#ffffff">
                            <span style="font-size:0.8rem">Background</span>
                        </div>
                        <label style="display:flex; align-items:center;">
                            <input type="checkbox" id="bg-trans" style="width:auto; margin-right:8px;"> Transparent BG
                        </label>
                    </div>

                    <div style="margin-top:10px; padding-top:10px; border-top:1px dashed #333;">
                        <label style="display:flex; align-items:center;">
                            <input type="checkbox" id="use-custom-corners" style="width:auto; margin-right:8px;"> Separate Corner Colors
                        </label>
                        <div id="corner-colors-box" style="display:none; margin-top:5px;">
                            <div class="color-group">
                                <input type="color" id="col-frame" value="#000000">
                                <span style="font-size:0.8rem">Frame</span>
                            </div>
                            <div class="color-group">
                                <input type="color" id="col-center" value="#000000">
                                <span style="font-size:0.8rem">Center Dot</span>
                            </div>
                        </div>
                    </div>
                </div>
            </details>

            <details>
                <summary>üí† Shapes</summary>
                <div class="inner-content">
                    <div class="row">
                        <div class="col">
                            <label>Dots</label>
                            <select id="dots-style">
                                <option value="square">Square</option>
                                <option value="dots">Dots</option>
                                <option value="rounded">Rounded</option>
                                <option value="extra-rounded">Ex-Round</option>
                                <option value="classy">Classy</option>
                                <option value="classy-rounded">Classy-R</option>
                            </select>
                        </div>
                        <div class="col">
                            <label>Frame</label>
                            <select id="frame-style">
                                <option value="square">Square</option>
                                <option value="extra-rounded">Round</option>
                                <option value="dot">Dot</option>
                                <option value="classy">Classy</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label>Center</label>
                            <select id="center-style">
                                <option value="square">Square</option>
                                <option value="dot">Dot</option>
                            </select>
                        </div>
                    </div>
                </div>
            </details>

            <details>
                <summary>üñºÔ∏è Logo</summary>
                <div class="inner-content">
                    <input type="file" id="file-logo" accept="image/*" style="padding:0; border:none; background:transparent;">
                    <div class="row">
                        <div class="col">
                            <label>Size</label>
                            <input type="range" id="logo-size" min="0.1" max="0.5" step="0.05" value="0.4">
                        </div>
                        <div class="col">
                            <label>Margin</label>
                            <input type="number" id="logo-margin" value="5">
                        </div>
                    </div>
                </div>
            </details>

            <details open>
                <summary>üìè Download Size</summary>
                <div class="inner-content">
                    <div class="row">
                        <div class="col">
                            <label>Width</label>
                            <input type="number" id="width" value="2000" step="100">
                        </div>
                        <button id="lock-btn" class="lock-btn active">üîó</button>
                        <div class="col">
                            <label>Height</label>
                            <input type="number" id="height" value="2000" step="100">
                        </div>
                    </div>
                    <div class="row">
                         <div class="col">
                            <label>Margin</label>
                            <input type="number" id="margin" value="20">
                        </div>
                        <div class="col">
                            <label>Correction</label>
                            <select id="err-lvl">
                                <option value="L">Low</option>
                                <option value="M">Medium</option>
                                <option value="Q">Quartile</option>
                                <option value="H" selected>High</option>
                            </select>
                        </div>
                    </div>
                    <p style="font-size:0.7rem; color:#64748b; margin-top:5px;">*Preview size is fixed. Download uses these dimensions.</p>
                </div>
            </details>

        </div>
    </div>

    <div class="main-stage">
        
        <div id="fixed-preview-container"></div>
        
        <div class="action-bar">
            <button class="btn png" onclick="downloadQR('png')">PNG</button>
            <button class="btn jpg" onclick="downloadQR('jpeg')">JPG</button>
            <button class="btn svg" onclick="downloadQR('svg')">SVG</button>
        </div>
    </div>

    <script>
        // --- 1. PREVIEW ENGINE (Fixed Size) ---
        // Iska width height se download ka koi lena dena nahi hai.
        const previewQR = new QRCodeStyling({
            width: 380, 
            height: 380, 
            type: "svg", // SVG for crisp preview
            data: "https://github.com",
            dotsOptions: { color: "#000000", type: "square" },
            backgroundOptions: { color: "#ffffff" },
            imageOptions: { crossOrigin: "anonymous", margin: 5 }
        });
        
        // Render inside fixed container
        previewQR.append(document.getElementById("fixed-preview-container"));


        // --- 2. LOGIC & STATE ---
        let logoBase64 = "";
        let isLocked = true;
        let aspectRatio = 1;

        // --- 3. GET OPTIONS FUNCTION ---
        function getOptions(width, height) {
            // Data
            const data = document.getElementById('data').value;

            // Colors
            const gradType = document.getElementById('gradient-type').value;
            const c1 = document.getElementById('col-1').value;
            const c2 = document.getElementById('col-2').value;
            
            // Show/Hide Gradient Input
            document.getElementById('col-2-box').style.display = (gradType === 'solid') ? 'none' : 'flex';

            // Dot Color Config
            let dotColorVal = c1;
            let dotGradVal = undefined;

            if (gradType !== 'solid') {
                dotGradVal = {
                    type: gradType,
                    colorStops: [{ offset: 0, color: c1 }, { offset: 1, color: c2 }]
                };
                // Library needs color to be undefined if gradient is active
                dotColorVal = undefined; 
            }

            // Custom Corners
            const useCustom = document.getElementById('use-custom-corners').checked;
            document.getElementById('corner-colors-box').style.display = useCustom ? 'block' : 'none';
            
            let frameCol = useCustom ? document.getElementById('col-frame').value : c1;
            let centerCol = useCustom ? document.getElementById('col-center').value : c1;

            // Background
            const isTrans = document.getElementById('bg-trans').checked;
            const bgCol = isTrans ? 'transparent' : document.getElementById('col-bg').value;

            return {
                width: width,
                height: height,
                data: data,
                image: logoBase64,
                margin: parseInt(document.getElementById('margin').value),
                dotsOptions: { 
                    type: document.getElementById('dots-style').value,
                    color: dotColorVal,
                    gradient: dotGradVal
                },
                cornersSquareOptions: { type: document.getElementById('frame-style').value, color: frameCol },
                cornersDotOptions: { type: document.getElementById('center-style').value, color: centerCol },
                backgroundOptions: { color: bgCol },
                imageOptions: { 
                    imageSize: parseFloat(document.getElementById('logo-size').value),
                    margin: parseInt(document.getElementById('logo-margin').value)
                },
                qrOptions: { errorCorrectionLevel: document.getElementById('err-lvl').value }
            };
        }

        // --- 4. UPDATE PREVIEW ---
        function updatePreview() {
            // Preview is ALWAYS 380x380 (minus padding) effectively
            // But we pass 380 here so library generates correct scaling
            const opts = getOptions(380, 380);
            previewQR.update(opts);
        }

        // --- 5. DOWNLOAD ENGINE ---
        async function downloadQR(format) {
            const w = parseInt(document.getElementById('width').value);
            const h = parseInt(document.getElementById('height').value);
            
            const opts = getOptions(w, h);

            // JPG Transparency Fix
            if(format === 'jpeg' && opts.backgroundOptions.color === 'transparent') {
                opts.backgroundOptions.color = '#ffffff';
            }

            const dlQR = new QRCodeStyling({
                ...opts,
                type: format === 'svg' ? 'svg' : 'canvas'
            });

            await dlQR.download({ name: "qr-code", extension: format });
        }

        // --- 6. EVENT LISTENERS ---
        
        // Logo
        document.getElementById('file-logo').addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => { logoBase64 = e.target.result; updatePreview(); };
                reader.readAsDataURL(file);
            } else { logoBase64 = ""; updatePreview(); }
        });

        // Aspect Lock
        const wIn = document.getElementById('width');
        const hIn = document.getElementById('height');
        const lBtn = document.getElementById('lock-btn');
        lBtn.addEventListener('click', () => {
            isLocked = !isLocked;
            lBtn.classList.toggle('active');
            if(isLocked) aspectRatio = wIn.value / hIn.value;
        });
        wIn.addEventListener('input', () => { if(isLocked) hIn.value = Math.round(wIn.value / aspectRatio); });
        hIn.addEventListener('input', () => { if(isLocked) wIn.value = Math.round(wIn.value * aspectRatio); });

        // Update on any input
        document.querySelectorAll('input:not(#width):not(#height):not(#file-logo), select').forEach(el => {
            el.addEventListener('input', updatePreview);
            el.addEventListener('change', updatePreview);
        });

        // Initial Draw
        updatePreview();

    </script>
</body>
</html>
