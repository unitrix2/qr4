<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compact Omni QR Pro</title>
    <script type="text/javascript" src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --panel-bg: #ffffff;
            --accent: #2563eb;
            --text: #1e293b;
            --border: #e2e8f0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            color: var(--text);
            height: 100vh;
            overflow: hidden; /* Prevents full page scroll */
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            background: var(--panel-bg);
            padding: 10px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 50px;
            flex-shrink: 0;
        }
        h1 { margin: 0; font-size: 1.2rem; color: var(--accent); }

        /* Main Layout - Split Screen */
        .main-container {
            display: flex;
            height: calc(100vh - 50px); /* Fill remaining height */
            width: 100%;
        }

        /* LEFT: Scrollable Controls */
        .controls-panel {
            width: 400px;
            background: var(--panel-bg);
            border-right: 1px solid var(--border);
            padding: 15px;
            overflow-y: auto; /* Only this part scrolls */
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* RIGHT: Fixed Preview Area */
        .preview-panel {
            flex-grow: 1;
            background: #eef2ff;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }

        /* --- THE PREVIEW FIX --- */
        #qr-wrapper {
            width: 100%;
            max-width: 450px; /* Max visual size */
            aspect-ratio: 1/1;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden; /* Important */
        }

        /* Force canvas/svg to fit visually regardless of actual resolution */
        #qr-wrapper canvas, #qr-wrapper svg {
            width: 100% !important;
            height: 100% !important;
            object-fit: contain;
        }

        /* Compact Inputs */
        .section {
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            background: #f8fafc;
        }
        .section-title {
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .row { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; }
        .col { flex: 1; }
        
        label { font-size: 0.75rem; font-weight: 600; display: block; margin-bottom: 3px; }
        
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            font-size: 0.85rem;
            box-sizing: border-box;
        }

        /* Custom Range Slider */
        input[type="range"] { width: 100%; height: 4px; }

        /* Color Pickers - Compact */
        input[type="color"] {
            -webkit-appearance: none;
            width: 100%; height: 30px;
            padding: 0; border: none;
            border-radius: 4px; overflow: hidden; cursor: pointer;
        }

        /* Aspect Ratio Lock Button */
        .lock-btn {
            background: none; border: 1px solid #cbd5e1;
            border-radius: 4px; padding: 5px; cursor: pointer;
            color: #64748b; font-size: 1rem; line-height: 1;
        }
        .lock-btn.active { background: #dbeafe; color: var(--accent); border-color: var(--accent); }

        /* Download Buttons */
        .download-bar {
            margin-top: 20px;
            display: flex; gap: 10px;
        }
        .btn-dl {
            padding: 10px 20px; border: none; border-radius: 6px;
            color: white; font-weight: 600; cursor: pointer;
            transition: transform 0.1s;
        }
        .btn-dl:active { transform: scale(0.95); }
        .bg-png { background: #10b981; }
        .bg-jpg { background: #f59e0b; }
        .bg-svg { background: #ef4444; }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .main-container { flex-direction: column-reverse; height: auto; overflow: auto; }
            body { overflow: auto; height: auto; }
            .controls-panel { width: 100%; border-right: none; border-top: 1px solid var(--border); }
            .preview-panel { min-height: 350px; position: sticky; top: 0; z-index: 10; border-bottom: 1px solid #ccc; }
        }
    </style>
</head>
<body>

<header>
    <h1>QR Master</h1>
    <div style="font-size: 0.8rem; color: #666;">High Res â€¢ Vector â€¢ Custom</div>
</header>

<div class="main-container">
    
    <div class="controls-panel">
        
        <div class="section">
            <div class="section-title">Content</div>
            <input type="text" id="data" placeholder="https://yourlink.com" value="https://github.com">
        </div>

        <div class="section">
            <div class="section-title">Size & Resolution</div>
            <div class="row">
                <div class="col">
                    <label>Width (px)</label>
                    <input type="number" id="width" value="1000" step="100">
                </div>
                <button id="lock-btn" class="lock-btn active" title="Lock Aspect Ratio">ðŸ”—</button>
                <div class="col">
                    <label>Height (px)</label>
                    <input type="number" id="height" value="1000" step="100">
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <label>Margin</label>
                    <input type="number" id="margin" value="20">
                </div>
                <div class="col">
                    <label>Error Correction</label>
                    <select id="error-level">
                        <option value="L">Low</option>
                        <option value="M">Medium</option>
                        <option value="Q">Quartile</option>
                        <option value="H" selected>High (Best for Logos)</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Shapes & Style</div>
            <div class="row">
                <div class="col">
                    <label>Dots Style</label>
                    <select id="dots-type">
                        <option value="square">Square</option>
                        <option value="dots">Dots</option>
                        <option value="rounded">Rounded</option>
                        <option value="extra-rounded">Extra Rounded</option>
                        <option value="classy">Classy</option>
                        <option value="classy-rounded">Classy-R</option>
                    </select>
                </div>
                <div class="col">
                    <label>Corner Frame</label>
                    <select id="corners-square-type">
                        <option value="extra-rounded">Extra Rnd</option>
                        <option value="square">Square</option>
                        <option value="dot">Dot</option>
                        <option value="classy">Classy</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <label>Corner Center</label>
                    <select id="corners-dot-type">
                        <option value="dot">Dot</option>
                        <option value="square">Square</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Colors</div>
            <div class="row">
                <div class="col">
                    <label>Dots Color</label>
                    <input type="color" id="color-dots" value="#000000">
                </div>
                <div class="col">
                    <label>Background</label>
                    <input type="color" id="color-bg" value="#ffffff">
                </div>
            </div>
            <label style="display:flex; align-items:center; font-size: 0.8rem; margin-top:5px;">
                <input type="checkbox" id="bg-transparent" style="width:auto; margin-right:5px;"> Transparent Background
            </label>
        </div>

        <div class="section">
            <div class="section-title">Logo / Image</div>
            <input type="file" id="file-logo" accept="image/*" style="border:none; padding-left:0;">
            
            <div class="row" style="margin-top:5px;">
                <div class="col">
                    <label>Logo Size</label>
                    <input type="range" id="image-size" min="0.1" max="0.6" step="0.05" value="0.4">
                </div>
                <div class="col">
                     <label>Margin around Logo</label>
                     <input type="number" id="image-margin" value="10">
                </div>
            </div>
        </div>

    </div> <div class="preview-panel">
        <div id="qr-wrapper"></div>
        
        <div class="download-bar">
            <button class="btn-dl bg-png" onclick="downloadQR('png')">PNG</button>
            <button class="btn-dl bg-jpg" onclick="downloadQR('jpeg')">JPG</button>
            <button class="btn-dl bg-svg" onclick="downloadQR('svg')">SVG</button>
        </div>
        <p style="font-size: 0.75rem; color: #666; margin-top: 10px;">
            Preview is fit to screen. Download is actual size.
        </p>
    </div>

</div>

<script>
    // --- State & Config ---
    let aspectRatioLocked = true;
    let aspectRatio = 1;

    let qrOptions = {
        width: 1000,
        height: 1000,
        type: "svg",
        data: "https://github.com",
        image: "",
        margin: 20,
        qrOptions: { typeNumber: 0, mode: "Byte", errorCorrectionLevel: "H" },
        imageOptions: { hideBackgroundDots: true, imageSize: 0.4, margin: 10, crossOrigin: "anonymous" },
        dotsOptions: { type: "square", color: "#000000" },
        backgroundOptions: { color: "#ffffff" },
        cornersSquareOptions: { type: "extra-rounded", color: "#000000" },
        cornersDotOptions: { type: "dot", color: "#000000" },
    };

    const qrCode = new QRCodeStyling(qrOptions);
    const canvasContainer = document.getElementById("qr-wrapper");
    qrCode.append(canvasContainer);

    // --- Aspect Ratio Logic ---
    const widthInput = document.getElementById('width');
    const heightInput = document.getElementById('height');
    const lockBtn = document.getElementById('lock-btn');

    lockBtn.addEventListener('click', () => {
        aspectRatioLocked = !aspectRatioLocked;
        lockBtn.classList.toggle('active');
        if(aspectRatioLocked) {
            // Reset ratio based on current width
            aspectRatio = widthInput.value / heightInput.value;
        }
    });

    widthInput.addEventListener('input', () => {
        if(aspectRatioLocked) {
            heightInput.value = Math.round(widthInput.value / aspectRatio);
        }
        updateQRCode();
    });

    heightInput.addEventListener('input', () => {
        if(aspectRatioLocked) {
            widthInput.value = Math.round(heightInput.value * aspectRatio);
        }
        updateQRCode();
    });

    // --- Main Update Function ---
    function updateQRCode() {
        // Data
        qrOptions.data = document.getElementById('data').value;
        
        // Dimensions
        qrOptions.width = parseInt(document.getElementById('width').value);
        qrOptions.height = parseInt(document.getElementById('height').value);
        qrOptions.margin = parseInt(document.getElementById('margin').value);
        qrOptions.qrOptions.errorCorrectionLevel = document.getElementById('error-level').value;

        // Styles
        qrOptions.dotsOptions.type = document.getElementById('dots-type').value;
        qrOptions.cornersSquareOptions.type = document.getElementById('corners-square-type').value;
        qrOptions.cornersDotOptions.type = document.getElementById('corners-dot-type').value;

        // Colors
        const dotColor = document.getElementById('color-dots').value;
        qrOptions.dotsOptions.color = dotColor;
        qrOptions.cornersSquareOptions.color = dotColor; // Match corners
        qrOptions.cornersDotOptions.color = dotColor;

        const isTransparent = document.getElementById('bg-transparent').checked;
        qrOptions.backgroundOptions.color = isTransparent ? 'transparent' : document.getElementById('color-bg').value;

        // Logo
        qrOptions.imageOptions.imageSize = parseFloat(document.getElementById('image-size').value);
        qrOptions.imageOptions.margin = parseInt(document.getElementById('image-margin').value);

        qrCode.update(qrOptions);
    }

    // --- Event Listeners ---
    document.getElementById('file-logo').addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                qrOptions.image = e.target.result;
                updateQRCode();
            }
            reader.readAsDataURL(file);
        } else {
            qrOptions.image = "";
            updateQRCode();
        }
    });

    // Attach listener to all other inputs
    const inputs = document.querySelectorAll('input:not(#width):not(#height):not(#file-logo), select');
    inputs.forEach(el => el.addEventListener('input', updateQRCode));

    // --- Download ---
    function downloadQR(format) {
        let currentBg = qrOptions.backgroundOptions.color;
        // Fix for JPG transparency
        if (format === 'jpeg' && currentBg === 'transparent') {
            qrOptions.backgroundOptions.color = '#ffffff';
            qrCode.update(qrOptions);
        }
        
        qrCode.download({ name: "qr-code", extension: format }).then(() => {
             // Restore
             if (format === 'jpeg' && currentBg === 'transparent') {
                qrOptions.backgroundOptions.color = 'transparent';
                qrCode.update(qrOptions);
             }
        });
    }

    // Init
    updateQRCode();

</script>
</body>
</html>
